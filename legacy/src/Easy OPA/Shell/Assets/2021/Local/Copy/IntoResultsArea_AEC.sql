exec [dbo].[AEC_PrepareForNewData] '${returnPeriod}'
go

INSERT INTO [ReferenceInput].[AppsEarningHistory_ApprenticeshipEarningsHistory]
	([AppIdentifier]
	,[AppProgCompletedInTheYearInput]
	,[CollectionYear]
	,[CollectionReturnCode]
	,[DaysInYear]
	,[FworkCode]
	,[HistoricEffectiveTNPStartDateInput]
	,[HistoricEmpIdEndWithinYear]
	,[HistoricEmpIdStartWithinYear]
	,[HistoricLearner1618StartInput]
	,[HistoricPMRAmount]
	,[HistoricTNP1Input]
	,[HistoricTNP2Input]
	,[HistoricTNP3Input]
	,[HistoricTNP4Input]
	,[HistoricTotal1618UpliftPaymentsInTheYearInput]
	,[HistoricVirtualTNP3EndOfTheYearInput]
	,[HistoricVirtualTNP4EndOfTheYearInput]
	,[HistoricLearnDelProgEarliestACT2DateInput]
	,[LatestInYear]
	,[LearnRefNumber]
	,[ProgrammeStartDateIgnorePathway]
	,[ProgrammeStartDateMatchPathway]
	,[ProgType]
	,[PwayCode]
	,[STDCode]
	,[TotalProgAimPaymentsInTheYear]
	,[UptoEndDate]
	,[UKPRN]
	,[ULN])
SELECT 
	[AppIdentifierOutput]
	,[AppProgCompletedInTheYearOutput]
	,'${year}'
	,'${returnPeriod}'
	,[HistoricDaysInYearOutput]
	,[HistoricFworkCodeOutput]
	,[HistoricEffectiveTNPStartDateOutput]
	,[HistoricEmpIdEndWithinYearOutput]
	,[HistoricEmpIdStartWithinYearOutput]
	,[HistoricLearner1618AtStartOutput]
	,[HistoricPMRAmountOutput]
	,[HistoricTNP1Output]
	,[HistoricTNP2Output]
	,[HistoricTNP3Output]
	,[HistoricTNP4Output]
	,[HistoricTotal1618UpliftPaymentsInTheYear]
	,[HistoricVirtualTNP3EndofThisYearOutput]
	,[HistoricVirtualTNP4EndofThisYearOutput]
	,[HistoricLearnDelProgEarliestACT2DateOutput]
	,1 as LatestInYear --true/1
	,[LearnRefNumber]
	,[HistoricProgrammeStartDateIgnorePathwayOutput]
	,[HistoricProgrammeStartDateMatchPathwayOutput]
	,[HistoricProgTypeOutput]
	,[HistoricPwayCodeOutput]
	,[HistoricSTDCodeOutput]
	,[HistoricTotalProgAimPaymentsInTheYear]
	,[HistoricUptoEndDateOutput]
	,[UKPRN]
	,[HistoricULNOutput]
FROM [Rulebase].[AEC_HistoricEarningOutput]
go
